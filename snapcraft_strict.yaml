# snapcraft_strict.yaml
# ---------------------
# Strict confinement Snapcraft manifest for SamRewritten.
#
# Note: This configuration is primarily for development and screenshots.
#       Due to strict confinement, access to certain Steam libraries under hidden folders (e.g., .local/share/Steam)
#       is not possible, even with custom plugs. This works in devmode, but not in strict mode for production use.
#
# See also: snapcraft.yaml (for classic confinement or production builds)

name: samrewritten
version: "1.0"
summary: Steam Achievements Manager (Rewritten)
description: |
  Unlock and manage achievements and stats on Steam. Cross-platform, modern, and open source.
confinement: strict
base: core24
license: GPL-3.0

parts:
  samrewritten:
    plugin: rust
    source: .
    build-environment:
      - RUSTUP_TOOLCHAIN: stable
    build-packages:
      - libpango1.0-dev
      - libcairo2-dev
      - libglib2.0-dev
      - libssl-dev
      - pkg-config
    stage-packages:
      - glib-networking

plugs:
  access-steam-folder:
    interface: personal-files
    read:
      - "$HOME/snap/steam/common/.local/share/Steam/linux64/steamclient.so"
    # TODO: This plug does not work under strict confinement for hidden folders. See top-level comment.

slots:
  dbus-samrewritten:
    interface: dbus
    bus: session
    name: org.sam_authors.sam_rewritten

apps:
  samrewritten:
    environment:
      LD_LIBRARY_PATH: "$LD_LIBRARY_PATH:$SNAP/usr/lib/$CRAFT_ARCH_TRIPLET_BUILD_FOR/libproxy" # Remove when fixed upstream
    command: bin/samrewritten
    extensions: [gnome]
    plugs:
      - access-steam-folder
      - network
      - wayland
      - x11
      - home
    slots:
      - dbus-samrewritten